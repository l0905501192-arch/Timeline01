<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion æ¥µè‡´ç¾åŒ–æ™‚é–“ç·š V4 (è²“å’ª&åå­—æ˜Ÿ)</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --line-color: #e0e0e0;
            --global-node-color: #3b82f6;
            --text-color: #37352f;
            --card-bg: #ffffff;
            --font-size: 16px;
        }

        body {
            margin: 0;
            padding: 40px 10px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        /* --- æ§åˆ¶é¢æ¿ (é ‚éƒ¨æ‡¸æµ®) --- */
        #controls {
            position: sticky; top: 15px; z-index: 100;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px) saturate(180%);
            padding: 12px 18px; border-radius: 16px;
            margin: 0 auto 60px auto; max-width: 820px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            display: flex; flex-wrap: wrap; gap: 14px; align-items: center;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .control-group { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; color: #555; }
        input[type="color"] { width: 24px; height: 24px; border: 2px solid rgba(0,0,0,0.1); cursor: pointer; border-radius: 50%; padding: 0; overflow: hidden; }
        input[type="number"] { width: 45px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }

        button {
            cursor: pointer; padding: 8px 16px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.08);
            background: rgba(255,255,255,0.8); font-weight: 600; transition: all 0.2s;
            font-size: 13px; color: #333;
        }
        button:hover { background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transform: translateY(-1px); }
        .btn-primary { background: #2383e2; color: white; border: none; }
        .btn-primary:hover { background: #1a73ca; box-shadow: 0 4px 15px rgba(35, 131, 226, 0.35); }

        /* --- æ™‚é–“ç·šçµæ§‹ --- */
        .timeline-container {
            position: relative; max-width: 960px; margin: 0 auto; padding: 30px 0;
        }

        /* ä¸­å¤®ä¸»ç·š (å„ªåŒ–ï¼šå…©ç«¯æ¼¸è®Šæ·¡å‡º) */
        .timeline-line {
            position: absolute; left: 50%; top: 0; bottom: 0;
            width: 3px; background-color: var(--line-color);
            transform: translateX(-50%); border-radius: 2px; z-index: 1;
            /* ä½¿ç”¨é®ç½©è®“ç·šæ¢å…©ç«¯æ¼¸éš± */
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
        }

        /* ç¯€é»å¤–å±¤å®¹å™¨ */
        .node-wrapper {
            position: relative; width: 100%; margin-bottom: 50px;
            display: flex; justify-content: center; align-items: center;
        }
        /* å·¦å³ä½ˆå±€é‚è¼¯ */
        .node-wrapper.left { justify-content: flex-start; padding-right: 50%; box-sizing: border-box; }
        .node-wrapper.right { justify-content: flex-end; padding-left: 50%; box-sizing: border-box; }

        /* --- ç¯€é»åœ–å½¢æ ¸å¿ƒ (ä¿®å¾©è®Šå½¢å•é¡Œ) --- */
        .node-dot-container {
            position: absolute; left: 50%; top: 22px;
            transform: translateX(-50%); z-index: 3;
            /* é—œéµï¼šè¨­å®šåš´æ ¼çš„æ­£æ–¹å½¢å°ºå¯¸ */
            width: 26px; height: 26px;
            display: flex; align-items: center; justify-content: center;
        }

        .node-dot {
            width: 100%; height: 100%;
            background-color: var(--global-node-color); /* é è¨­è‰²ï¼ŒJSæœƒè¦†è“‹ */
            /* ä½¿ç”¨ box-shadow ä»£æ›¿ border ä¾†è£½é€ èˆ‡èƒŒæ™¯çš„é–“éš”ï¼Œé¿å…è®Šå½¢ */
            box-shadow: 0 0 0 4px var(--bg-color); 
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* å½ˆæ€§å‹•ç•« */
        }
        .node-wrapper:hover .node-dot { transform: scale(1.15); }

        /* --- å½¢ç‹€å®šç¾© --- */
        .shape-circle { border-radius: 50%; }
        .shape-rounded { border-radius: 8px; }
        .shape-square { border-radius: 3px; }
        /* æ—‹è½‰çš„åœ–å½¢éœ€å…ˆç¸®å°ä¸€é»é¿å…è¦–è¦ºä¸Šéå¤§ */
        .shape-diamond { transform: rotate(45deg) scale(0.9); border-radius: 3px; }
        /* è¤‡é›œåœ–å½¢ä½¿ç”¨ clip-pathï¼Œä¸¦ç§»é™¤ box-shadow æ”¹ç”¨ drop-shadow */
        .shape-hexagon { clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); box-shadow: none; filter: drop-shadow(0 0 3px var(--bg-color)); }
        .shape-star { clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); box-shadow: none; filter: drop-shadow(0 0 3px var(--bg-color));}
        /* V4 æ–°å¢åœ–å½¢ */
        .shape-cross-star { clip-path: polygon(50% 0%, 55% 45%, 100% 50%, 55% 55%, 50% 100%, 45% 55%, 0% 50%, 45% 45%); box-shadow: none; filter: drop-shadow(0 0 3px var(--bg-color)); transform: scale(1.1); }
        
        /* è²“å’ªå½¢ç‹€ (ä½¿ç”¨å½å…ƒç´ ç¹ªè£½è€³æœµ) */
        .shape-cat {
            border-radius: 50%; position: relative;
            /* é€™è£¡éœ€è¦ç”¨ borderï¼Œå› ç‚ºå½å…ƒç´ è¦å®šä½åœ¨å®ƒå¾Œé¢ */
            box-shadow: none;
            border: 4px solid var(--bg-color);
            background-clip: padding-box; /* é˜²æ­¢èƒŒæ™¯è‰²æ»²é€åˆ°é‚Šæ¡†ä¸‹ */
        }
        /* è€³æœµ */
        .shape-cat::before, .shape-cat::after {
            content: ''; position: absolute; top: -5px; z-index: -1;
            width: 0; height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 10px solid currentColor; /* ä½¿ç”¨ç•¶å‰æ–‡å­—é¡è‰²(åœ¨JSä¸­è¨­ç½®) */
        }
        .shape-cat::before { left: -2px; transform: rotate(-25deg); }
        .shape-cat::after { right: -2px; transform: rotate(25deg); }


        /* --- å…§å®¹å¡ç‰‡ (ç¾åŒ–å‡ç´š) --- */
        .node-card {
            width: 85%; max-width: 400px; background: var(--card-bg);
            padding: 24px; border-radius: 20px;
            /* æ›´æŸ”å’Œã€æ·±é‚ƒçš„é›™å±¤é™°å½± */
            box-shadow: 
                0 6px 12px rgba(0,0,0,0.04), 
                0 12px 32px rgba(0,0,0,0.08);
            position: relative; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            margin: 0 40px;
            /* ç§»é™¤é‚Šæ¡†ï¼Œè¿½æ±‚æ¥µç°¡ */
            border: none;
        }
        
        .node-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 
                0 12px 20px rgba(0,0,0,0.06), 
                0 24px 48px rgba(0,0,0,0.1);
        }
        
        /* ç®­é ­æŒ‡ç¤ºå™¨ */
        .node-wrapper.left .node-card::after, .node-wrapper.right .node-card::after {
            content: ''; position: absolute; top: 30px;
            width: 12px; height: 12px; background: var(--card-bg);
            transform: rotate(45deg); z-index: 0;
        }
        .node-wrapper.left .node-card::after { right: -6px; box-shadow: 4px -4px 4px rgba(0,0,0,0.02); }
        .node-wrapper.right .node-card::after { left: -6px; box-shadow: -4px 4px 4px rgba(0,0,0,0.02); }


        .node-time {
            font-weight: 800; font-size: 0.9em; margin-bottom: 10px; display: block;
            letter-spacing: 0.05em; text-transform: uppercase; opacity: 0.9;
        }

        .node-desc { line-height: 1.7; outline: none; font-size: var(--font-size); opacity: 0.85; }

        /* --- å€‹åˆ¥æ§åˆ¶é … --- */
        .node-settings {
            margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.06);
            display: none; flex-wrap: wrap; gap: 8px; font-size: 12px; color: #888; align-items: center;
        }
        .node-wrapper:hover .node-settings { display: flex; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); }}

        .node-settings select { padding: 4px 8px; border-radius: 6px; border: 1px solid #eee; font-size: 11px; cursor: pointer; background: #f9f9f9; }
        .node-settings button.btn-reset { padding: 4px 8px; font-size: 11px; background: #eee; border: none; color: #666; border-radius: 4px; }
        .node-settings button.btn-reset:hover { background: #ddd; color: #333; }

        .delete-btn {
            position: absolute; top: 12px; right: 12px; width: 24px; height: 24px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; cursor: pointer; opacity: 0; transition: 0.2s; 
            background: rgba(255, 77, 79, 0.1); color: #ff4d4f; font-size: 14px;
        }
        .node-card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { background: #ff4d4f; color: white; }

        /* --- éŸ¿æ‡‰å¼ --- */
        @media (max-width: 768px) {
            .timeline-line { left: 25px; width: 2px; }
            .node-dot-container { left: 25px; width: 22px; height: 22px; top: 24px; }
            .node-dot { box-shadow: 0 0 0 3px var(--bg-color); }
            .node-wrapper.left, .node-wrapper.right { justify-content: flex-start; padding-left: 60px; padding-right: 15px; margin-bottom: 35px;}
            .node-card { max-width: 100%; margin: 0; padding: 20px; }
            .node-wrapper.left .node-card::after { left: -6px; right: auto; box-shadow: -4px 4px 4px rgba(0,0,0,0.02); }
            #controls { top: 5px; padding: 10px; margin-bottom: 30px;}
        }

        /* å”¯è®€æ¨¡å¼ */
        body.readonly #controls, body.readonly .node-settings, body.readonly .delete-btn, body.readonly #addBtn { display: none !important; }
        body.readonly .node-desc { pointer-events: none; }
        body.readonly { padding-top: 20px; }
    </style>
</head>
<body>

<div id="controls">
    <div class="control-group">èƒŒæ™¯<input type="color" id="bgColor" value="#ffffff"></div>
    <div class="control-group">ç·šæ¢<input type="color" id="lineColor" value="#e0e0e0"></div>
    <div class="control-group">ä¸»è‰²<input type="color" id="globalNodeColor" value="#3b82f6"></div>
    <div class="control-group">æ–‡å­—<input type="color" id="textColor" value="#37352f"></div>
    <div class="control-group">å­—ç´š<input type="number" id="fontSize" value="16" min="12" max="24"></div>
    <div style="flex-grow: 1;"></div>
    <button class="btn-primary" onclick="generateShareLink()">ğŸ“‹ ç”Ÿæˆåˆ†äº«é€£çµ</button>
</div>

<div class="timeline-container">
    <div class="timeline-line"></div>
    <div id="nodesContainer"></div>
    <div id="addBtn" style="text-align: center; margin-top: 50px;">
        <button onclick="addNode()" style="padding: 10px 24px; border: 2px dashed #ccc; color: #888; background: none; border-radius: 12px;">+ æ–°å¢æ™‚é–“ç¯€é»</button>
    </div>
</div>

<script>
    let state = {
        bg: '#ffffff', line: '#e0e0e0', globalNode: '#3b82f6', text: '#37352f', size: 16,
        items: [
            { time: 'é‡Œç¨‹ç¢‘ 01', desc: 'æ­¡è¿ä½¿ç”¨å…¨æ–°çš„ V4 æ™‚é–“ç·šã€‚ç¾åœ¨åœ–å½¢ä¸å†è®Šå½¢ï¼Œä¸”æ›´åŠ ç²¾ç·»ã€‚', side: 'left', shape: 'cat', color: '#ff79c6' },
            { time: 'é‡è¦æ›´æ–°', desc: 'æˆ‘å€‘æ–°å¢äº†ã€Œåå­—æ˜Ÿã€èˆ‡ã€Œè²“å’ªã€å½¢ç‹€ï¼æ»‘é¼ ç§»ä¸Šä¾†çœ‹çœ‹æ•ˆæœã€‚', side: 'right', shape: 'cross-star', color: '#f59e0b' },
            { time: 'æœªä¾†è¨ˆç•«', desc: 'å·¦å³äº¤éŒ¯çš„æ’ç‰ˆè®“è³‡è¨Šæµå‹•æ›´å…·æ•˜äº‹æ„Ÿã€‚ä½ å¯ä»¥åœ¨ä¸‹æ–¹éš¨æ„åˆ‡æ›ã€‚', side: 'left', shape: 'rounded' }
        ]
    };

    function init() {
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');
        if (data) {
            try { state = JSON.parse(decodeURIComponent(atob(data))); } catch (e) {}
            if (params.get('mode') === 'view') document.body.classList.add('readonly');
        }
        // æ ¹æ“šèƒŒæ™¯äº®åº¦èª¿æ•´æ§åˆ¶é¢æ¿æ¨£å¼ (ç°¡å–®å„ªåŒ–)
        if (isDarkColor(state.bg)) {
            document.getElementById('controls').style.background = 'rgba(0, 0, 0, 0.6)';
            document.getElementById('controls').style.borderColor = 'rgba(255, 255, 255, 0.1)';
            document.querySelectorAll('.control-group').forEach(el => el.style.color = '#ccc');
        }
        render();
    }

    function render() {
        document.documentElement.style.setProperty('--bg-color', state.bg);
        document.documentElement.style.setProperty('--line-color', state.line);
        document.documentElement.style.setProperty('--global-node-color', state.globalNode);
        document.documentElement.style.setProperty('--text-color', state.text);
        document.documentElement.style.setProperty('--font-size', state.size + 'px');
        document.documentElement.style.setProperty('--card-bg', state.bg);

        const container = document.getElementById('nodesContainer');
        container.innerHTML = '';

        state.items.forEach((item, index) => {
            const side = item.side || 'left';
            const color = item.color || state.globalNode;
            const shape = item.shape || 'circle';
            
            const node = document.createElement('div');
            node.className = `node-wrapper ${side}`;
            // é€™è£¡å°‡é¡è‰²è³¦äºˆ style.colorï¼Œè®“è²“å’ªå½¢ç‹€çš„å½å…ƒç´ å¯ä»¥ä½¿ç”¨ currentColor ç¹¼æ‰¿
            node.innerHTML = `
                <div class="node-dot-container">
                    <div class="node-dot shape-${shape}" style="background-color: ${color}; color: ${color};"></div>
                </div>
                <div class="node-card">
                    <div class="delete-btn" onclick="removeNode(${index})">âœ•</div>
                    <span class="node-time" style="color: ${color}" contenteditable="true" onblur="updateItem(${index}, 'time', this.innerText)">${item.time}</span>
                    <div class="node-desc" contenteditable="true" onblur="updateItem(${index}, 'desc', this.innerText)">${item.desc}</div>
                    
                    <div class="node-settings">
                        <span>è¨­å®š:</span>
                        <select onchange="updateItem(${index}, 'side', this.value)" title="ä½ç½®">
                            <option value="left" ${side==='left'?'selected':''}>â¬… å·¦å´</option>
                            <option value="right" ${side==='right'?'selected':''}>â¡ å³å´</option>
                        </select>
                        <select onchange="updateItem(${index}, 'shape', this.value)" title="å½¢ç‹€">
                            <option value="cat" ${shape==='cat'?'selected':''}>ğŸ± è²“å’ª</option>
                            <option value="cross-star" ${shape==='cross-star'?'selected':''}>âœ¨ åå­—æ˜Ÿ</option>
                            <option value="circle" ${shape==='circle'?'selected':''}>â— åœ“å½¢</option>
                            <option value="rounded" ${shape==='rounded'?'selected':''}>â–  åœ“è§’</option>
                            <option value="square" ${shape==='square'?'selected':''}>â–  æ–¹å½¢</option>
                            <option value="diamond" ${shape==='diamond'?'selected':''}>â—† è±å½¢</option>
                            <option value="hexagon" ${shape==='hexagon'?'selected':''}>â¬¡ å…­è§’å½¢</option>
                            <option value="star" ${shape==='star'?'selected':''}>â˜… æ˜Ÿå½¢</option>
                        </select>
                        <input type="color" value="${color}" onchange="updateItem(${index}, 'color', this.value)" title="å€‹åˆ¥é¡è‰²">
                        <button class="btn-reset" onclick="resetItem(${index})">é‡ç½®</button>
                    </div>
                </div>
            `;
            container.appendChild(node);
        });
    }

    function updateItem(index, key, value) { state.items[index][key] = value; if (key !== 'time' && key !== 'desc') render(); }
    function addNode() { state.items.push({ time: 'New Node', desc: 'ç·¨è¼¯å…§å®¹...', side: state.items.length % 2 === 0 ? 'left' : 'right', shape: 'circle' }); render(); }
    function removeNode(index) { if(confirm('ç¢ºå®šåˆªé™¤?')) { state.items.splice(index, 1); render(); }}
    function resetItem(index) { delete state.items[index].color; delete state.items[index].shape; render(); }
    
    // ç°¡å–®åˆ¤æ–·æ˜¯å¦ç‚ºæ·±è‰²èƒŒæ™¯
    function isDarkColor(hex) {
        let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
        return (r * 0.299 + g * 0.587 + b * 0.114) < 180;
    }

    document.getElementById('bgColor').oninput = (e) => { state.bg = e.target.value; render(); };
    document.getElementById('lineColor').oninput = (e) => { state.line = e.target.value; render(); };
    document.getElementById('globalNodeColor').oninput = (e) => { state.globalNode = e.target.value; render(); };
    document.getElementById('textColor').oninput = (e) => { state.text = e.target.value; render(); };
    document.getElementById('fontSize').oninput = (e) => { state.size = e.target.value; render(); };

    function generateShareLink() {
        const base64Data = btoa(encodeURIComponent(JSON.stringify(state)));
        const url = `${window.location.origin}${window.location.pathname}?mode=view&data=${base64Data}`;
        navigator.clipboard.writeText(url).then(()=> alert('é€£çµå·²è¤‡è£½ï¼è«‹åœ¨ Notion ä½¿ç”¨ /embed è²¼ä¸Šã€‚'), ()=>alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ç¶²å€ã€‚'));
    }

    init();
</script>
</body>
</html>
