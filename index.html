<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion ç¾åŒ–ç‰ˆå¯ç·¨è¼¯æ™‚é–“ç·š V2</title>
    <style>
        :root {
            /* å…¨å±€è®Šæ•¸ */
            --bg-color: #ffffff;
            --line-color: #e0e0e0;
            --global-node-color: #3b82f6;
            --text-color: #37352f;
            --card-bg: #ffffff; /* å¡ç‰‡èƒŒæ™¯è‰²ï¼Œé€šå¸¸æ¯”èƒŒæ™¯ç¨å¾®äº®ä¸€é»æˆ–æŒå¹³ */
            --font-size: 16px;
        }

        body {
            margin: 0;
            padding: 30px 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background 0.3s, color 0.3s;
        }

        /* --- æ§åˆ¶é¢æ¿ --- */
        #controls {
            background: rgba(247, 247, 245, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            border: 1px solid rgba(0,0,0,0.08);
        }

        .control-group { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;}
        input[type="color"] { width: 30px; height: 30px; border: none; padding: 0; background: none; cursor: pointer; border-radius: 50%; overflow: hidden; box-shadow: 0 0 0 1px rgba(0,0,0,0.1);}
        input[type="number"] { padding: 4px; border: 1px solid #ddd; border-radius: 4px;}

        button {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background: white;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        button:hover { background: #f0f0f0; }
        .btn-primary { background: #2383e2; color: white; border: none; }
        .btn-primary:hover { background: #1a73ca; box-shadow: 0 2px 5px rgba(35, 131, 226, 0.3); }

        /* --- æ™‚é–“ç·šä¸»é«”çµæ§‹ --- */
        .timeline-container {
            position: relative;
            max-width: 700px;
            margin: 0 auto;
            padding: 20px 0 20px 30px; /* å·¦å´ç•™ç©ºçµ¦ç·šæ¢ */
        }

        /* å‚ç›´ä¸»ç·š */
        .timeline-line {
            position: absolute;
            left: 13px; /* èª¿æ•´ç·šæ¢ä½ç½®ä»¥å°é½Šç¯€é»ä¸­å¿ƒ */
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: var(--line-color);
            border-radius: 1.5px;
            z-index: 0;
        }

        /* å–®ä¸€ç¯€é»å€å¡Š */
        .node-wrapper {
            position: relative;
            margin-bottom: 35px;
        }

        /* ç¯€é»åœ“é»/å½¢ç‹€ */
        .node-dot {
            position: absolute;
            left: -30px; /* èª¿æ•´ä»¥å°é½Šç·šæ¢ä¸­å¿ƒ */
            top: 12px; /* èª¿æ•´å‚ç›´å°é½Š */
            width: 16px;
            height: 16px;
            /* èƒŒæ™¯è‰²èˆ‡å½¢ç‹€ç”± JS å‹•æ…‹æ§åˆ¶ */
            border: 3px solid var(--bg-color); /* ç”¨é‚Šæ¡†è£½é€ èˆ‡ç·šæ¢çš„é–“éš”æ„Ÿ */
            z-index: 2;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        /* å½¢ç‹€é¡åˆ¥ */
        .shape-circle { border-radius: 50%; }
        .shape-square { border-radius: 2px; }
        .shape-rounded { border-radius: 6px; }


        /* --- ç¾åŒ–å¾Œçš„å…§å®¹å¡ç‰‡ --- */
        .node-card {
            position: relative;
            background: var(--card-bg);
            padding: 12px 18px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.06), 0 0 1px rgba(0,0,0,0.1);
            font-size: var(--font-size);
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        /* å¡ç‰‡äº’å‹•å‹•ç•« */
        .node-card:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1), 0 0 1px rgba(0,0,0,0.1);
            border-color: rgba(0,0,0,0.05);
        }
        
        .node-wrapper:hover .node-dot {
             transform: scale(1.2); /* æ»‘é¼ ç§»åˆ°å¡ç‰‡æ™‚ï¼Œé»ä¹Ÿç¨å¾®æ”¾å¤§ */
        }

        .node-time {
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
            color: var(--global-node-color); /* æ™‚é–“é¡è‰²é è¨­è·Ÿéš¨å…¨å±€ç¯€é»è‰² */
            opacity: 0.9;
            font-size: 0.9em;
        }

        .node-desc {
            line-height: 1.5;
            outline: none; /* ç§»é™¤ç·¨è¼¯æ™‚çš„è—æ¡† */
        }

        /* åˆªé™¤æŒ‰éˆ• */
        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            display: flex; align-items: center; justify-content: center;
            color: #999;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0; /* é è¨­éš±è— */
            transition: all 0.2s;
            background: rgba(0,0,0,0.05);
        }
        .delete-btn:hover { color: white; background: #ff4d4f; }
        .node-card:hover .delete-btn { opacity: 1; } /* hover å¡ç‰‡æ™‚é¡¯ç¤º */


        /* --- å€‹åˆ¥ç¯€é»è¨­å®šåˆ— (Hover æ™‚é¡¯ç¤º) --- */
        .node-individual-controls {
            margin-top: 8px;
            padding: 8px 12px;
            background: rgba(0,0,0,0.03);
            border-radius: 6px;
            display: none; /* é è¨­éš±è— */
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: #666;
            animation: fadeIn 0.3s ease;
        }
        /* æ»‘é¼ æ»‘éæ•´å€‹ç¯€é»å€åŸŸæ™‚é¡¯ç¤ºè¨­å®šåˆ— */
        .node-wrapper:hover .node-individual-controls {
            display: flex;
        }

        .node-individual-controls select {
            padding: 2px 4px; border-radius: 4px; border: 1px solid #ddd; font-size: 12px;
        }
        .btn-reset { padding: 2px 6px; font-size: 11px; background: none; border: 1px solid #ccc;}
        .btn-reset:hover { border-color: #999; color: #333; background: #ddd;}

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); }}


        /* --- å”¯è®€æ¨¡å¼ (ç”¨æ–¼åˆ†äº«é€£çµ) --- */
        body.readonly #controls { display: none !important; }
        body.readonly .delete-btn { display: none !important; }
        body.readonly .add-node-btn-container { display: none !important; }
        body.readonly .node-individual-controls { display: none !important; } /* é‡è¦ï¼šéš±è—å€‹åˆ¥æ§åˆ¶é … */
        body.readonly .node-card:hover { transform: translateY(-3px) scale(1.01); } /* ä¿æŒå‹•ç•« */
        body.readonly [contenteditable="true"] { contenteditable="false"; } /* ç¦æ­¢ç·¨è¼¯æ–‡å­— */
        body.readonly { padding-top: 50px; }

    </style>
</head>
<body id="body">

<div id="controls">
    <div class="control-group" title="å…¨å±€èƒŒæ™¯é¡è‰²">èƒŒæ™¯ <input type="color" id="bgColor" value="#ffffff"></div>
    <div class="control-group" title="æ™‚é–“ç·šæ¢é¡è‰²">ç·šæ¢ <input type="color" id="lineColor" value="#e0e0e0"></div>
    <div class="control-group" title="é è¨­ç¯€é»é¡è‰²">é è¨­ç¯€é» <input type="color" id="globalNodeColor" value="#3b82f6"></div>
    <div class="control-group" title="æ–‡å­—é¡è‰²">æ–‡å­— <input type="color" id="textColor" value="#37352f"></div>
    <div class="control-group">å­—é«” <input type="number" id="fontSize" value="16" style="width: 45px;" min="12" max="24"> px</div>
    <div style="flex-grow: 1;"></div> <button class="btn-primary" onclick="generateShareLink()">ğŸ“‹ ç”Ÿæˆåˆ†äº«é€£çµ</button>
</div>

<div class="timeline-container">
    <div class="timeline-line"></div>
    <div id="nodesContainer">
        </div>
    <div class="add-node-btn-container" style="margin-top: 20px; text-align: center;">
        <button onclick="addNode()" style="padding: 8px 20px; border: 2px dashed #ccc; color: #666;">+ æ–°å¢æ™‚é–“ç¯€é»</button>
    </div>
</div>

<script>
    // åˆå§‹ç‹€æ…‹è³‡æ–™çµæ§‹
    let state = {
        bg: '#ffffff',
        line: '#e0e0e0',
        globalNode: '#3b82f6',
        text: '#37352f',
        size: 16,
        // items ç¾åœ¨åŒ…å«å¯é¸çš„ 'color' å’Œ 'shape' å±¬æ€§
        items: [
            { time: '2024-Q1', desc: 'å°ˆæ¡ˆå•Ÿå‹•æœƒè­°ï¼Œç¢ºèªæ ¸å¿ƒç›®æ¨™ã€‚', shape: 'circle' },
            { time: '2024-04-15', desc: 'ç¬¬ä¸€éšæ®µé–‹ç™¼å®Œæˆï¼Œé€²è¡Œå…§éƒ¨æ¸¬è©¦ã€‚ (æ»‘éæˆ‘çœ‹çœ‹æ•ˆæœ)', color: '#10b981', shape: 'rounded' },
            { time: 'å³å°‡åˆ°ä¾†', desc: 'æº–å‚™ç™¼å¸ƒ Beta ç‰ˆæœ¬çµ¦ç¨®å­ç”¨æˆ¶ã€‚', shape: 'square' }
        ]
    };

    // åˆå§‹åŒ–å‡½æ•¸
    function init() {
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');
        const mode = params.get('mode');

        if (data) {
            try {
                state = JSON.parse(decodeURIComponent(atob(data)));
            } catch (e) {
                console.error("è³‡æ–™è§£æå¤±æ•—", e);
                alert("é€£çµè³‡æ–™ä¼¼ä¹ææ¯€äº†ã€‚å°‡åŠ è¼‰é è¨­å…§å®¹ã€‚");
            }
        }
        
        if (mode === 'view') {
            document.body.classList.add('readonly');
            // åœ¨å”¯è®€æ¨¡å¼ä¸‹ï¼Œç§»é™¤ contenteditable å±¬æ€§
            const editables = document.querySelectorAll('[contenteditable="true"]');
            editables.forEach(el => el.setAttribute('contenteditable', 'false'));
        } else {
            // ç·¨è¼¯æ¨¡å¼ä¸‹ï¼ŒåŒæ­¥æ§åˆ¶é …çš„å€¼
            document.getElementById('bgColor').value = state.bg;
            document.getElementById('lineColor').value = state.line;
            document.getElementById('globalNodeColor').value = state.globalNode;
            document.getElementById('textColor').value = state.text;
            document.getElementById('fontSize').value = state.size;
        }

        render();
    }

    // æ¸²æŸ“å‡½æ•¸ (æ ¸å¿ƒé‚è¼¯)
    function render() {
        // æ›´æ–° CSS è®Šæ•¸
        document.documentElement.style.setProperty('--bg-color', state.bg);
        document.documentElement.style.setProperty('--line-color', state.line);
        document.documentElement.style.setProperty('--global-node-color', state.globalNode);
        document.documentElement.style.setProperty('--text-color', state.text);
        document.documentElement.style.setProperty('--font-size', state.size + 'px');
        // æ ¹æ“šèƒŒæ™¯äº®åº¦è‡ªå‹•èª¿æ•´å¡ç‰‡èƒŒæ™¯è‰² (ç°¡å–®ç‰ˆ)
        const cardBg = state.bg === '#ffffff' ? '#ffffff' : adjustColorBrightness(state.bg, 10);
        document.documentElement.style.setProperty('--card-bg', cardBg);

        const container = document.getElementById('nodesContainer');
        container.innerHTML = '';

        const isReadonly = document.body.classList.contains('readonly');

        state.items.forEach((item, index) => {
            // æ±ºå®šæ­¤ç¯€é»çš„é¡è‰²èˆ‡å½¢ç‹€ (å„ªå…ˆä½¿ç”¨å€‹åˆ¥è¨­å®šï¼Œå¦å‰‡ä½¿ç”¨å…¨å±€)
            const nodeColor = item.color || state.globalNode;
            const nodeShapeClass = `shape-${item.shape || 'circle'}`;
            // æ™‚é–“æ–‡å­—é¡è‰²ï¼šå¦‚æœæœ‰è‡ªå®šç¾©ç¯€é»è‰²å°±ç”¨è©²è‰²ï¼Œå¦å‰‡ç”¨å…¨å±€è¨­å®š
            const timeColorStyle = item.color ? `color: ${item.color}` : '';

            const nodeWrapper = document.createElement('div');
            nodeWrapper.className = 'node-wrapper';
            nodeWrapper.innerHTML = `
                <div class="node-dot ${nodeShapeClass}" style="background-color: ${nodeColor}; border-color: var(--bg-color);"></div>
                
                <div class="node-card">
                    <span class="delete-btn" onclick="removeNode(${index})">âœ•</span>
                    <span class="node-time" style="${timeColorStyle}" contenteditable="${!isReadonly}" onblur="updateText(${index}, 'time', this.innerText)">${item.time}</span>
                    <div class="node-desc" contenteditable="${!isReadonly}" onblur="updateText(${index}, 'desc', this.innerText)">${item.desc}</div>
                </div>

                <div class="node-individual-controls">
                    <span>å€‹åˆ¥è¨­å®š:</span>
                    <input type="color" title="æ­¤ç¯€é»é¡è‰²" value="${nodeColor}" onchange="updateItemSetting(${index}, 'color', this.value)">
                    <select title="æ­¤ç¯€é»å½¢ç‹€" onchange="updateItemSetting(${index}, 'shape', this.value)">
                        <option value="circle" ${(!item.shape || item.shape === 'circle') ? 'selected' : ''}>åœ“å½¢</option>
                        <option value="rounded" ${item.shape === 'rounded' ? 'selected' : ''}>åœ“è§’</option>
                        <option value="square" ${item.shape === 'square' ? 'selected' : ''}>æ–¹å½¢</option>
                    </select>
                    ${(item.color || item.shape) ? `<button class="btn-reset" onclick="resetItemSetting(${index})" title="æ¸…é™¤å€‹åˆ¥è¨­å®šï¼Œæ¢å¾©å…¨å±€æ¨£å¼">é‡ç½®</button>` : ''}
                </div>
            `;
            container.appendChild(nodeWrapper);
        });
    }

    // --- äº‹ä»¶è™•ç†èˆ‡è³‡æ–™æ“ä½œ ---

    // å…¨å±€è¨­å®šæ›´æ–°
    document.getElementById('bgColor').oninput = (e) => { state.bg = e.target.value; render(); };
    document.getElementById('lineColor').oninput = (e) => { state.line = e.target.value; render(); };
    document.getElementById('globalNodeColor').oninput = (e) => { state.globalNode = e.target.value; render(); };
    document.getElementById('textColor').oninput = (e) => { state.text = e.target.value; render(); };
    document.getElementById('fontSize').oninput = (e) => { state.size = e.target.value; render(); };

    // ç¯€é»æ“ä½œ
    function addNode() {
        // æ–°ç¯€é»é è¨­ä¸å¸¶å€‹åˆ¥é¡è‰²å’Œå½¢ç‹€ï¼Œä½¿ç”¨å…¨å±€è¨­å®š
        state.items.push({ time: 'æ–°æ™‚é–“é»', desc: 'é»æ“Šç·¨è¼¯æè¿°å…§å®¹...' });
        render();
    }

    function removeNode(index) {
        if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ™‚é–“ç¯€é»å—ï¼Ÿ')) {
            state.items.splice(index, 1);
            render();
        }
    }

    function updateText(index, key, value) {
        state.items[index][key] = value;
        // ä¸éœ€è¦ renderï¼Œå› ç‚ºæ˜¯ contenteditable ç›´æ¥ä¿®æ”¹çš„
    }

    // æ›´æ–°å€‹åˆ¥ç¯€é»çš„ç‰¹æ®Šè¨­å®š (é¡è‰²/å½¢ç‹€)
    function updateItemSetting(index, key, value) {
        state.items[index][key] = value;
        render();
    }

    // é‡ç½®å€‹åˆ¥ç¯€é»è¨­å®š (ç§»é™¤å±¬æ€§ï¼Œå›æ­¸å…¨å±€)
    function resetItemSetting(index) {
        delete state.items[index].color;
        delete state.items[index].shape;
        render();
    }

    // ç”Ÿæˆåˆ†äº«é€£çµ
    function generateShareLink() {
        // ä½¿ç”¨ encodeURIComponent è™•ç†ä¸­æ–‡ï¼Œé¿å… Base64 ç·¨ç¢¼å•é¡Œ
        const base64Data = btoa(encodeURIComponent(JSON.stringify(state)));
        const url = `${window.location.origin}${window.location.pathname}?mode=view&data=${base64Data}`;
        
        navigator.clipboard.writeText(url).then(() => {
            alert('âœ… å”¯è®€åˆ†äº«é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\n\nä½ å¯ä»¥å°‡æ­¤é€£çµåµŒå…¥åˆ° Notion ä¸­ã€‚');
        }, (err) => {
            console.error('ç„¡æ³•è¤‡è£½æ–‡å­—: ', err);
            alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ç¶²å€åˆ—çš„é€£çµ (è«‹å…ˆç¢ºä¿ç¶²å€å·²æ›´æ–°)ã€‚');
        });
    }

    // è¼”åŠ©å‡½æ•¸ï¼šèª¿æ•´é¡è‰²äº®åº¦ (ç”¨æ–¼å¡ç‰‡èƒŒæ™¯)
    function adjustColorBrightness(hex, percent) {
        // é€™è£¡åªæ˜¯ä¸€å€‹éå¸¸ç°¡å–®çš„å¯¦ä½œï¼Œç”¨æ–¼ç¨å¾®æ”¹è®Šå¡ç‰‡èƒŒæ™¯è‰²
        // åœ¨æ·±è‰²èƒŒæ™¯æ¨¡å¼ä¸‹å¯èƒ½éœ€è¦æ›´è¤‡é›œçš„ç®—æ³•
        return hex; 
    }

    // å•Ÿå‹•
    init();
</script>
</body>
</html>
