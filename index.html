<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion 可編輯時間線</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --line-color: #e0e0e0;
            --node-color: #3b82f6;
            --text-color: #37352f;
            --font-size: 16px;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background 0.3s;
        }

        /* 控制面板 - Notion 嵌入時隱藏 */
        #controls {
            background: #f7f7f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .control-group { display: flex; align-items: center; gap: 5px; font-size: 14px; }

        /* 時間線主體 */
        .timeline-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
            padding-left: 40px;
        }

        .timeline-line {
            position: absolute;
            left: 19px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--line-color);
        }

        .node {
            position: relative;
            margin-bottom: 30px;
        }

        .node-dot {
            position: absolute;
            left: -26px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--node-color);
            border: 2px solid var(--bg-color);
            z-index: 2;
        }

        .node-content {
            font-size: var(--font-size);
            outline: none;
            min-height: 20px;
        }

        .node-time {
            font-weight: bold;
            margin-bottom: 4px;
            display: block;
        }

        button {
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background: white;
        }

        .delete-btn { color: red; border-color: pink; margin-left: 10px; cursor: pointer; opacity: 0.3; }
        .node:hover .delete-btn { opacity: 1; }

        /* 隱藏控制項的模式 (用於分享連結) */
        body.readonly #controls { display: none; }
        body.readonly .delete-btn { display: none; }
        body.readonly .add-node-btn { display: none; }
    </style>
</head>
<body id="body">

<div id="controls">
    <div class="control-group">背景 <input type="color" id="bgColor" value="#ffffff"></div>
    <div class="control-group">線條 <input type="color" id="lineColor" value="#e0e0e0"></div>
    <div class="control-group">節點 <input type="color" id="nodeColor" value="#3b82f6"></div>
    <div class="control-group">文字 <input type="color" id="textColor" value="#37352f"></div>
    <div class="control-group">字體 <input type="number" id="fontSize" value="16" style="width: 40px;">px</div>
    <button onclick="addNode()">+ 新增節點</button>
    <button onclick="generateShareLink()" style="background: #2383e2; color: white; border: none;">生成分享連結</button>
</div>

<div class="timeline-container">
    <div class="timeline-line" id="mainLine"></div>
    <div id="nodesContainer">
        </div>
</div>

<script>
    let state = {
        bg: '#ffffff',
        line: '#e0e0e0',
        node: '#3b82f6',
        text: '#37352f',
        size: 16,
        items: [{ time: '2024-01', desc: '點擊編輯內容' }]
    };

    function init() {
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');
        if (data) {
            state = JSON.parse(atob(data));
            if (params.get('mode') === 'view') document.body.classList.add('readonly');
        }
        render();
    }

    function render() {
        document.documentElement.style.setProperty('--bg-color', state.bg);
        document.documentElement.style.setProperty('--line-color', state.line);
        document.documentElement.style.setProperty('--node-color', state.node);
        document.documentElement.style.setProperty('--text-color', state.text);
        document.documentElement.style.setProperty('--font-size', state.size + 'px');

        const container = document.getElementById('nodesContainer');
        container.innerHTML = '';
        state.items.forEach((item, index) => {
            const node = document.createElement('div');
            node.className = 'node';
            node.innerHTML = `
                <div class="node-dot"></div>
                <div class="node-content">
                    <span class="node-time" contenteditable="true" onblur="updateText(${index}, 'time', this.innerText)">${item.time}</span>
                    <span contenteditable="true" onblur="updateText(${index}, 'desc', this.innerText)">${item.desc}</span>
                    <span class="delete-btn" onclick="removeNode(${index})">✕</span>
                </div>
            `;
            container.appendChild(node);
        });
    }

    // 事件處理
    document.getElementById('bgColor').oninput = (e) => { state.bg = e.target.value; render(); };
    document.getElementById('lineColor').oninput = (e) => { state.line = e.target.value; render(); };
    document.getElementById('nodeColor').oninput = (e) => { state.node = e.target.value; render(); };
    document.getElementById('textColor').oninput = (e) => { state.text = e.target.value; render(); };
    document.getElementById('fontSize').oninput = (e) => { state.size = e.target.value; render(); };

    function addNode() {
        state.items.push({ time: '新時間', desc: '新內容' });
        render();
    }

    function removeNode(index) {
        state.items.splice(index, 1);
        render();
    }

    function updateText(index, key, value) {
        state.items[index][key] = value;
    }

    function generateShareLink() {
        const base64Data = btoa(JSON.stringify(state));
        const url = `${window.location.origin}${window.location.pathname}?mode=view&data=${base64Data}`;
        
        navigator.clipboard.writeText(url);
        alert('分享連結已複製到剪貼簿！(唯讀模式)');
    }

    init();
</script>
</body>
</html>